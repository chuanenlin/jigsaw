{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.extendSubschemaMode = exports.extendSubschemaData = exports.getSubschema = void 0;\nconst codegen_1 = require(\"../codegen\");\nconst util_1 = require(\"../util\");\nfunction getSubschema(it, _ref) {\n  let {\n    keyword,\n    schemaProp,\n    schema,\n    schemaPath,\n    errSchemaPath,\n    topSchemaRef\n  } = _ref;\n  if (keyword !== undefined && schema !== undefined) {\n    throw new Error('both \"keyword\" and \"schema\" passed, only one allowed');\n  }\n  if (keyword !== undefined) {\n    const sch = it.schema[keyword];\n    return schemaProp === undefined ? {\n      schema: sch,\n      schemaPath: (0, codegen_1._)`${it.schemaPath}${(0, codegen_1.getProperty)(keyword)}`,\n      errSchemaPath: `${it.errSchemaPath}/${keyword}`\n    } : {\n      schema: sch[schemaProp],\n      schemaPath: (0, codegen_1._)`${it.schemaPath}${(0, codegen_1.getProperty)(keyword)}${(0, codegen_1.getProperty)(schemaProp)}`,\n      errSchemaPath: `${it.errSchemaPath}/${keyword}/${(0, util_1.escapeFragment)(schemaProp)}`\n    };\n  }\n  if (schema !== undefined) {\n    if (schemaPath === undefined || errSchemaPath === undefined || topSchemaRef === undefined) {\n      throw new Error('\"schemaPath\", \"errSchemaPath\" and \"topSchemaRef\" are required with \"schema\"');\n    }\n    return {\n      schema,\n      schemaPath,\n      topSchemaRef,\n      errSchemaPath\n    };\n  }\n  throw new Error('either \"keyword\" or \"schema\" must be passed');\n}\nexports.getSubschema = getSubschema;\nfunction extendSubschemaData(subschema, it, _ref2) {\n  let {\n    dataProp,\n    dataPropType: dpType,\n    data,\n    dataTypes,\n    propertyName\n  } = _ref2;\n  if (data !== undefined && dataProp !== undefined) {\n    throw new Error('both \"data\" and \"dataProp\" passed, only one allowed');\n  }\n  const {\n    gen\n  } = it;\n  if (dataProp !== undefined) {\n    const {\n      errorPath,\n      dataPathArr,\n      opts\n    } = it;\n    const nextData = gen.let(\"data\", (0, codegen_1._)`${it.data}${(0, codegen_1.getProperty)(dataProp)}`, true);\n    dataContextProps(nextData);\n    subschema.errorPath = (0, codegen_1.str)`${errorPath}${(0, util_1.getErrorPath)(dataProp, dpType, opts.jsPropertySyntax)}`;\n    subschema.parentDataProperty = (0, codegen_1._)`${dataProp}`;\n    subschema.dataPathArr = [...dataPathArr, subschema.parentDataProperty];\n  }\n  if (data !== undefined) {\n    const nextData = data instanceof codegen_1.Name ? data : gen.let(\"data\", data, true); // replaceable if used once?\n    dataContextProps(nextData);\n    if (propertyName !== undefined) subschema.propertyName = propertyName;\n    // TODO something is possibly wrong here with not changing parentDataProperty and not appending dataPathArr\n  }\n\n  if (dataTypes) subschema.dataTypes = dataTypes;\n  function dataContextProps(_nextData) {\n    subschema.data = _nextData;\n    subschema.dataLevel = it.dataLevel + 1;\n    subschema.dataTypes = [];\n    it.definedProperties = new Set();\n    subschema.parentData = it.data;\n    subschema.dataNames = [...it.dataNames, _nextData];\n  }\n}\nexports.extendSubschemaData = extendSubschemaData;\nfunction extendSubschemaMode(subschema, _ref3) {\n  let {\n    jtdDiscriminator,\n    jtdMetadata,\n    compositeRule,\n    createErrors,\n    allErrors\n  } = _ref3;\n  if (compositeRule !== undefined) subschema.compositeRule = compositeRule;\n  if (createErrors !== undefined) subschema.createErrors = createErrors;\n  if (allErrors !== undefined) subschema.allErrors = allErrors;\n  subschema.jtdDiscriminator = jtdDiscriminator; // not inherited\n  subschema.jtdMetadata = jtdMetadata; // not inherited\n}\n\nexports.extendSubschemaMode = extendSubschemaMode;","map":{"version":3,"names":["codegen_1","require","util_1","getSubschema","it","_ref","keyword","schemaProp","schema","schemaPath","errSchemaPath","topSchemaRef","undefined","Error","sch","_","getProperty","escapeFragment","exports","extendSubschemaData","subschema","_ref2","dataProp","dataPropType","dpType","data","dataTypes","propertyName","gen","errorPath","dataPathArr","opts","nextData","let","dataContextProps","str","getErrorPath","jsPropertySyntax","parentDataProperty","Name","_nextData","dataLevel","definedProperties","Set","parentData","dataNames","extendSubschemaMode","_ref3","jtdDiscriminator","jtdMetadata","compositeRule","createErrors","allErrors"],"sources":["/Users/chuanenl/MyDrive/CMU/Projects/Jigsaw/Code/Frontend/node_modules/ajv/lib/compile/validate/subschema.ts"],"sourcesContent":["import type {AnySchema} from \"../../types\"\nimport type {SchemaObjCxt} from \"..\"\nimport {_, str, getProperty, Code, Name} from \"../codegen\"\nimport {escapeFragment, getErrorPath, Type} from \"../util\"\nimport type {JSONType} from \"../rules\"\n\nexport interface SubschemaContext {\n  // TODO use Optional? align with SchemCxt property types\n  schema: AnySchema\n  schemaPath: Code\n  errSchemaPath: string\n  topSchemaRef?: Code\n  errorPath?: Code\n  dataLevel?: number\n  dataTypes?: JSONType[]\n  data?: Name\n  parentData?: Name\n  parentDataProperty?: Code | number\n  dataNames?: Name[]\n  dataPathArr?: (Code | number)[]\n  propertyName?: Name\n  jtdDiscriminator?: string\n  jtdMetadata?: boolean\n  compositeRule?: true\n  createErrors?: boolean\n  allErrors?: boolean\n}\n\nexport type SubschemaArgs = Partial<{\n  keyword: string\n  schemaProp: string | number\n  schema: AnySchema\n  schemaPath: Code\n  errSchemaPath: string\n  topSchemaRef: Code\n  data: Name | Code\n  dataProp: Code | string | number\n  dataTypes: JSONType[]\n  definedProperties: Set<string>\n  propertyName: Name\n  dataPropType: Type\n  jtdDiscriminator: string\n  jtdMetadata: boolean\n  compositeRule: true\n  createErrors: boolean\n  allErrors: boolean\n}>\n\nexport function getSubschema(\n  it: SchemaObjCxt,\n  {keyword, schemaProp, schema, schemaPath, errSchemaPath, topSchemaRef}: SubschemaArgs\n): SubschemaContext {\n  if (keyword !== undefined && schema !== undefined) {\n    throw new Error('both \"keyword\" and \"schema\" passed, only one allowed')\n  }\n\n  if (keyword !== undefined) {\n    const sch = it.schema[keyword]\n    return schemaProp === undefined\n      ? {\n          schema: sch,\n          schemaPath: _`${it.schemaPath}${getProperty(keyword)}`,\n          errSchemaPath: `${it.errSchemaPath}/${keyword}`,\n        }\n      : {\n          schema: sch[schemaProp],\n          schemaPath: _`${it.schemaPath}${getProperty(keyword)}${getProperty(schemaProp)}`,\n          errSchemaPath: `${it.errSchemaPath}/${keyword}/${escapeFragment(schemaProp)}`,\n        }\n  }\n\n  if (schema !== undefined) {\n    if (schemaPath === undefined || errSchemaPath === undefined || topSchemaRef === undefined) {\n      throw new Error('\"schemaPath\", \"errSchemaPath\" and \"topSchemaRef\" are required with \"schema\"')\n    }\n    return {\n      schema,\n      schemaPath,\n      topSchemaRef,\n      errSchemaPath,\n    }\n  }\n\n  throw new Error('either \"keyword\" or \"schema\" must be passed')\n}\n\nexport function extendSubschemaData(\n  subschema: SubschemaContext,\n  it: SchemaObjCxt,\n  {dataProp, dataPropType: dpType, data, dataTypes, propertyName}: SubschemaArgs\n): void {\n  if (data !== undefined && dataProp !== undefined) {\n    throw new Error('both \"data\" and \"dataProp\" passed, only one allowed')\n  }\n\n  const {gen} = it\n\n  if (dataProp !== undefined) {\n    const {errorPath, dataPathArr, opts} = it\n    const nextData = gen.let(\"data\", _`${it.data}${getProperty(dataProp)}`, true)\n    dataContextProps(nextData)\n    subschema.errorPath = str`${errorPath}${getErrorPath(dataProp, dpType, opts.jsPropertySyntax)}`\n    subschema.parentDataProperty = _`${dataProp}`\n    subschema.dataPathArr = [...dataPathArr, subschema.parentDataProperty]\n  }\n\n  if (data !== undefined) {\n    const nextData = data instanceof Name ? data : gen.let(\"data\", data, true) // replaceable if used once?\n    dataContextProps(nextData)\n    if (propertyName !== undefined) subschema.propertyName = propertyName\n    // TODO something is possibly wrong here with not changing parentDataProperty and not appending dataPathArr\n  }\n\n  if (dataTypes) subschema.dataTypes = dataTypes\n\n  function dataContextProps(_nextData: Name): void {\n    subschema.data = _nextData\n    subschema.dataLevel = it.dataLevel + 1\n    subschema.dataTypes = []\n    it.definedProperties = new Set<string>()\n    subschema.parentData = it.data\n    subschema.dataNames = [...it.dataNames, _nextData]\n  }\n}\n\nexport function extendSubschemaMode(\n  subschema: SubschemaContext,\n  {jtdDiscriminator, jtdMetadata, compositeRule, createErrors, allErrors}: SubschemaArgs\n): void {\n  if (compositeRule !== undefined) subschema.compositeRule = compositeRule\n  if (createErrors !== undefined) subschema.createErrors = createErrors\n  if (allErrors !== undefined) subschema.allErrors = allErrors\n  subschema.jtdDiscriminator = jtdDiscriminator // not inherited\n  subschema.jtdMetadata = jtdMetadata // not inherited\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}