{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst code_1 = require(\"../code\");\nconst codegen_1 = require(\"../../compile/codegen\");\nconst names_1 = require(\"../../compile/names\");\nconst util_1 = require(\"../../compile/util\");\nconst error = {\n  message: \"must NOT have additional properties\",\n  params: _ref => {\n    let {\n      params\n    } = _ref;\n    return (0, codegen_1._)`{additionalProperty: ${params.additionalProperty}}`;\n  }\n};\nconst def = {\n  keyword: \"additionalProperties\",\n  type: [\"object\"],\n  schemaType: [\"boolean\", \"object\"],\n  allowUndefined: true,\n  trackErrors: true,\n  error,\n  code(cxt) {\n    const {\n      gen,\n      schema,\n      parentSchema,\n      data,\n      errsCount,\n      it\n    } = cxt;\n    /* istanbul ignore if */\n    if (!errsCount) throw new Error(\"ajv implementation error\");\n    const {\n      allErrors,\n      opts\n    } = it;\n    it.props = true;\n    if (opts.removeAdditional !== \"all\" && (0, util_1.alwaysValidSchema)(it, schema)) return;\n    const props = (0, code_1.allSchemaProperties)(parentSchema.properties);\n    const patProps = (0, code_1.allSchemaProperties)(parentSchema.patternProperties);\n    checkAdditionalProperties();\n    cxt.ok((0, codegen_1._)`${errsCount} === ${names_1.default.errors}`);\n    function checkAdditionalProperties() {\n      gen.forIn(\"key\", data, key => {\n        if (!props.length && !patProps.length) additionalPropertyCode(key);else gen.if(isAdditional(key), () => additionalPropertyCode(key));\n      });\n    }\n    function isAdditional(key) {\n      let definedProp;\n      if (props.length > 8) {\n        // TODO maybe an option instead of hard-coded 8?\n        const propsSchema = (0, util_1.schemaRefOrVal)(it, parentSchema.properties, \"properties\");\n        definedProp = (0, code_1.isOwnProperty)(gen, propsSchema, key);\n      } else if (props.length) {\n        definedProp = (0, codegen_1.or)(...props.map(p => (0, codegen_1._)`${key} === ${p}`));\n      } else {\n        definedProp = codegen_1.nil;\n      }\n      if (patProps.length) {\n        definedProp = (0, codegen_1.or)(definedProp, ...patProps.map(p => (0, codegen_1._)`${(0, code_1.usePattern)(cxt, p)}.test(${key})`));\n      }\n      return (0, codegen_1.not)(definedProp);\n    }\n    function deleteAdditional(key) {\n      gen.code((0, codegen_1._)`delete ${data}[${key}]`);\n    }\n    function additionalPropertyCode(key) {\n      if (opts.removeAdditional === \"all\" || opts.removeAdditional && schema === false) {\n        deleteAdditional(key);\n        return;\n      }\n      if (schema === false) {\n        cxt.setParams({\n          additionalProperty: key\n        });\n        cxt.error();\n        if (!allErrors) gen.break();\n        return;\n      }\n      if (typeof schema == \"object\" && !(0, util_1.alwaysValidSchema)(it, schema)) {\n        const valid = gen.name(\"valid\");\n        if (opts.removeAdditional === \"failing\") {\n          applyAdditionalSchema(key, valid, false);\n          gen.if((0, codegen_1.not)(valid), () => {\n            cxt.reset();\n            deleteAdditional(key);\n          });\n        } else {\n          applyAdditionalSchema(key, valid);\n          if (!allErrors) gen.if((0, codegen_1.not)(valid), () => gen.break());\n        }\n      }\n    }\n    function applyAdditionalSchema(key, valid, errors) {\n      const subschema = {\n        keyword: \"additionalProperties\",\n        dataProp: key,\n        dataPropType: util_1.Type.Str\n      };\n      if (errors === false) {\n        Object.assign(subschema, {\n          compositeRule: true,\n          createErrors: false,\n          allErrors: false\n        });\n      }\n      cxt.subschema(subschema, valid);\n    }\n  }\n};\nexports.default = def;","map":{"version":3,"names":["code_1","require","codegen_1","names_1","util_1","error","message","params","_ref","_","additionalProperty","def","keyword","type","schemaType","allowUndefined","trackErrors","code","cxt","gen","schema","parentSchema","data","errsCount","it","Error","allErrors","opts","props","removeAdditional","alwaysValidSchema","allSchemaProperties","properties","patProps","patternProperties","checkAdditionalProperties","ok","default","errors","forIn","key","length","additionalPropertyCode","if","isAdditional","definedProp","propsSchema","schemaRefOrVal","isOwnProperty","or","map","p","nil","usePattern","not","deleteAdditional","setParams","break","valid","name","applyAdditionalSchema","reset","subschema","dataProp","dataPropType","Type","Str","Object","assign","compositeRule","createErrors","exports"],"sources":["/Users/chuanenl/MyDrive/CMU/Projects/Jigsaw/Code/Frontend/node_modules/ajv/lib/vocabularies/applicator/additionalProperties.ts"],"sourcesContent":["import type {\n  CodeKeywordDefinition,\n  AddedKeywordDefinition,\n  ErrorObject,\n  KeywordErrorDefinition,\n  AnySchema,\n} from \"../../types\"\nimport {allSchemaProperties, usePattern, isOwnProperty} from \"../code\"\nimport {_, nil, or, not, Code, Name} from \"../../compile/codegen\"\nimport N from \"../../compile/names\"\nimport type {SubschemaArgs} from \"../../compile/validate/subschema\"\nimport {alwaysValidSchema, schemaRefOrVal, Type} from \"../../compile/util\"\n\nexport type AdditionalPropertiesError = ErrorObject<\n  \"additionalProperties\",\n  {additionalProperty: string},\n  AnySchema\n>\n\nconst error: KeywordErrorDefinition = {\n  message: \"must NOT have additional properties\",\n  params: ({params}) => _`{additionalProperty: ${params.additionalProperty}}`,\n}\n\nconst def: CodeKeywordDefinition & AddedKeywordDefinition = {\n  keyword: \"additionalProperties\",\n  type: [\"object\"],\n  schemaType: [\"boolean\", \"object\"],\n  allowUndefined: true,\n  trackErrors: true,\n  error,\n  code(cxt) {\n    const {gen, schema, parentSchema, data, errsCount, it} = cxt\n    /* istanbul ignore if */\n    if (!errsCount) throw new Error(\"ajv implementation error\")\n    const {allErrors, opts} = it\n    it.props = true\n    if (opts.removeAdditional !== \"all\" && alwaysValidSchema(it, schema)) return\n    const props = allSchemaProperties(parentSchema.properties)\n    const patProps = allSchemaProperties(parentSchema.patternProperties)\n    checkAdditionalProperties()\n    cxt.ok(_`${errsCount} === ${N.errors}`)\n\n    function checkAdditionalProperties(): void {\n      gen.forIn(\"key\", data, (key: Name) => {\n        if (!props.length && !patProps.length) additionalPropertyCode(key)\n        else gen.if(isAdditional(key), () => additionalPropertyCode(key))\n      })\n    }\n\n    function isAdditional(key: Name): Code {\n      let definedProp: Code\n      if (props.length > 8) {\n        // TODO maybe an option instead of hard-coded 8?\n        const propsSchema = schemaRefOrVal(it, parentSchema.properties, \"properties\")\n        definedProp = isOwnProperty(gen, propsSchema as Code, key)\n      } else if (props.length) {\n        definedProp = or(...props.map((p) => _`${key} === ${p}`))\n      } else {\n        definedProp = nil\n      }\n      if (patProps.length) {\n        definedProp = or(definedProp, ...patProps.map((p) => _`${usePattern(cxt, p)}.test(${key})`))\n      }\n      return not(definedProp)\n    }\n\n    function deleteAdditional(key: Name): void {\n      gen.code(_`delete ${data}[${key}]`)\n    }\n\n    function additionalPropertyCode(key: Name): void {\n      if (opts.removeAdditional === \"all\" || (opts.removeAdditional && schema === false)) {\n        deleteAdditional(key)\n        return\n      }\n\n      if (schema === false) {\n        cxt.setParams({additionalProperty: key})\n        cxt.error()\n        if (!allErrors) gen.break()\n        return\n      }\n\n      if (typeof schema == \"object\" && !alwaysValidSchema(it, schema)) {\n        const valid = gen.name(\"valid\")\n        if (opts.removeAdditional === \"failing\") {\n          applyAdditionalSchema(key, valid, false)\n          gen.if(not(valid), () => {\n            cxt.reset()\n            deleteAdditional(key)\n          })\n        } else {\n          applyAdditionalSchema(key, valid)\n          if (!allErrors) gen.if(not(valid), () => gen.break())\n        }\n      }\n    }\n\n    function applyAdditionalSchema(key: Name, valid: Name, errors?: false): void {\n      const subschema: SubschemaArgs = {\n        keyword: \"additionalProperties\",\n        dataProp: key,\n        dataPropType: Type.Str,\n      }\n      if (errors === false) {\n        Object.assign(subschema, {\n          compositeRule: true,\n          createErrors: false,\n          allErrors: false,\n        })\n      }\n      cxt.subschema(subschema, valid)\n    }\n  },\n}\n\nexport default def\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}